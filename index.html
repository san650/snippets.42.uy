<!DOCTYPE HTML>
<meta charset="UTF-8">
<body>
<main><h1>Snippets</h1></main>
<script>
	let hash = text => text.toLowerCase().replace(/[^a-z0-9]/g, '-').replace(/-+/g, '-')
	let mapBy = (attr, mappings) => collection => {
		collection.forEach(obj => {
			let key = obj[attr]
			if (key && mappings[key])
				mappings[key](obj)
			else throw new Error(`[Fail Fast]: The content type "${key}" is not supported by the app.`)
		})
		return collection;
	};
	let append = (target, type) => {
		let element = target.ownerDocument.createElement(type)
		target.appendChild(element)
		return element
	}
	let render = (target, funcs) => (...arguments) => {
		let article = append(target, 'article')
		funcs.forEach(f => f(article)(...arguments))
		return article;
	}
	let error = (target, notes) => error => {
		append(target, 'p').innerText = notes
		append(target, 'p').innerText = error
	}
	let renderTitle = target => ({title}) => {
		let h2 = append(target, 'h2');
		append(h2, 'span').innerText = title;
		let anchor = append(h2, 'a')
		anchor.innerText = 'Â¶'
		anchor.name = hash(title)
		anchor.href = `#${anchor.name}`
	}
	let renderNotes = target => ({notes}) => {
		if (!notes) return

		append(target, 'blockquote').innerText = notes; 
	}
	let renderBlobAsText = target => ({blob}) => {
		let code = append(append(target, 'p'), 'code')
		code.innerHTML = blob
	}
	let renderBlobAsHtml = target => ({blob}) => {
		append(target, 'p').innerHTML = blob
	}
	let renderBlobAsShell = target => ({blob}) => {
		let code = append(append(target, 'p'), 'code')
		code.innerHTML = blob
		code.classList.add('sh');
	}
	let debug = message => x => {
		console.log([message, x])
		return x;
	}

	var target = document.getElementsByTagName('main')[0];

	fetch('./snippets.json')
		.then(debug('fetch'))
		.then(r => r.json())
		.then(debug('json'))
		.then(d => d.snippets)
		.then(debug('map'))
		.then(mapBy('contentType', {
			'text/plain': render(target, [renderTitle, renderBlobAsText, renderNotes]),
			'text/html': render(target, [renderTitle, renderBlobAsHtml, renderNotes]),
			'application/x-sh': render(target, [renderTitle, renderBlobAsShell, renderNotes])
			}
		))
		.then(debug('render'))
		.then(() => {
			// Because snippets are rendered after DOMContentLoaded event happens, `:target` css rules are not applied to the generated DOM elements. We workaround this by triggering a same-page navigation by re-applying the hash to the URL.
			if (location.hash)
				location = `${location.hash}`
		})
		.catch(error(target, 'Error fetching snippets.json file'))
</script>
<style>
:root{
font-size:14px;
line-height:1;
}
h2 {
font-size:inherit;
padding:16px 0;
margin:1.5rem 0 0;
color: #745fb5;
font-size:19px;
font-weight: 400;
}
kdb {
background-color: #eee;
border-radius: .2rem;
border: 1px solid #b4b4b4;
box-shadow: 0 1px 1px rgba(0, 0, 0, .2), 0 2px 0 0 rgba(255, 255, 255, .7) inset;
color: #333;
display: inline-block;
padding: .2rem .3rem;
white-space: nowrap;
font-family: monospace;
}
h2 a{
display:inline-block;
margin-left: 1rem;
color: #ccc;
font-size: 1.5rem;
text-decoration: none;
font-family: monospace;
outline: none;
}
h2 a:hover{
color: #777;
}
.sh:before{display:inline-block;content: "$";margin-right:.5rem}

html, body {
background:#f1f3f5;
font-family: -apple-system,BlinkMacSystemFont,segoe ui,roboto,oxygen,ubuntu,cantarell,fira sans,droid sans,helvetica neue,sans-serif;
font-size: 14px;
line-height: 1.6;
color: #345;
}
main {
width: 100%;
max-width: 760px;
margin: 0 auto;
}
article {
border-radius: 2px;
}
blockquote {
background: #f8f9fa;
color: #678;	
margin:0;
padding:16px;
box-shadow: 0 6px 8px rgba(102,119,136,.03), 0 1px 2px rgba(102,119,136,.3);	
}
article p{
margin: 0;
padding: 0;
background: #fff;
padding:16px;
box-shadow: 0 6px 8px rgba(102,119,136,.03), 0 1px 2px rgba(102,119,136,.3);	
}
h1 {
font-size: 49px;
line-height: 1.2;
font-weight: 200;
font-family: -apple-system,BlinkMacSystemFont,segoe ui,roboto,oxygen,ubuntu,cantarell,fira sans,droid sans,helvetica neue,sans-serif;
margin: 0;
text-align:center;
}
:target:after {
display: inline-block;
content: "âŸµ  ðŸ‘€";
color: #777;
margin-left: 10px;
font-size: 2rem;
}
</style>
